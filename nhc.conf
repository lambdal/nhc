# NHC Configuration File
#
# Lines are in the form "<hostmask>||<check>"
# Hostmask is a glob, /regexp/, or {noderange}
# Comments begin with '#'
#
# This file was automatically generated by nhc-genconf
# Wed Jul 31 22:14:55 UTC 2024
#

#######################################################################
###
### NHC Configuration Variables
###
# * || export MARK_OFFLINE=1 NHC_CHECK_ALL=0

NHC_NVIDIA_HEALTHMON=dcgmi 
NHC_NVIDIA_HEALTHMON_ARGS=”diag -r 1”
NVIDIA_HEALTHMON=dcgmi 
NVIDIA_HEALTHMON_ARGS=”diag -r 1”

#######################################################################
###
### DMI Checks
###
# * || check_dmi_data_match -h 0x0000 -t 0 "BIOS Information: Version: 2.1"
# * || check_dmi_data_match -h 0x0001 -t 1 "System Information: Version: 0123456789"
# * || check_dmi_data_match -h 0x0002 -t 2 "Base Board Information: Version: 1.01"
# * || check_dmi_data_match -h 0x0003 -t 3 "Chassis Information: Version: 0123456789"
# * || check_dmi_data_match -h 0x0007 -t 38 "IPMI Device Information: Specification Version: 2.0"
# * || check_dmi_data_match -h 0x0009 -t 43 "TPM Device: Specification Version: 2.0"
# * || check_dmi_data_match -h 0x000D -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x000D -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x000D -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x000E -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x000E -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x000E -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x000F -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x000F -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x000F -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x0010 -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x0010 -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x0010 -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x0011 -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x0011 -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x0011 -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x0012 -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x0012 -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x0012 -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x0013 -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x0013 -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x0013 -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x0014 -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x0014 -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x0014 -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x0015 -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x0015 -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x0015 -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x0016 -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x0016 -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x0016 -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x0017 -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x0017 -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x0017 -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x0018 -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x0018 -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x0018 -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x0019 -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x0019 -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x0019 -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x001A -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x001A -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x001A -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x001B -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x001B -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x001B -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x001C -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x001C -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x001C -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x001D -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x001D -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x001D -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x001E -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x001E -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x001E -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x001F -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x001F -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x001F -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x0020 -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x0020 -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x0020 -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x0021 -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x0021 -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x0021 -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x0022 -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x0022 -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x0022 -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x0023 -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x0023 -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x0023 -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x0024 -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x0024 -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x0024 -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x0025 -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x0025 -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x0025 -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x0026 -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x0026 -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x0026 -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x0027 -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x0027 -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x0027 -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x0028 -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x0028 -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x0028 -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x0029 -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x0029 -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x0029 -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x002A -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x002A -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x002A -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x002B -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x002B -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x002B -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x002C -t 17 "Memory Device: Speed: 4800 MT/s"
# * || check_dmi_data_match -h 0x002C -t 17 "Memory Device: Configured Memory Speed: 4400 MT/s"
# * || check_dmi_data_match -h 0x002C -t 17 "Memory Device: Firmware Version: 0000 "
# * || check_dmi_data_match -h 0x0036 -t 7 "Cache Information: Speed: Unknown"
# * || check_dmi_data_match -h 0x0037 -t 7 "Cache Information: Speed: Unknown"
# * || check_dmi_data_match -h 0x0038 -t 7 "Cache Information: Speed: Unknown"
# * || check_dmi_data_match -h 0x0039 -t 4 "Processor Information: Version: Intel(R) Xeon(R) Platinum 8480+"
# * || check_dmi_data_match -h 0x0039 -t 4 "Processor Information: Max Speed: 4000 MHz"
# * || check_dmi_data_match -h 0x0039 -t 4 "Processor Information: Current Speed: 2000 MHz"
# * || check_dmi_data_match -h 0x003A -t 7 "Cache Information: Speed: Unknown"
# * || check_dmi_data_match -h 0x003B -t 7 "Cache Information: Speed: Unknown"
# * || check_dmi_data_match -h 0x003C -t 7 "Cache Information: Speed: Unknown"
# * || check_dmi_data_match -h 0x003D -t 4 "Processor Information: Version: Intel(R) Xeon(R) Platinum 8480+"
# * || check_dmi_data_match -h 0x003D -t 4 "Processor Information: Max Speed: 4000 MHz"
# * || check_dmi_data_match -h 0x003D -t 4 "Processor Information: Current Speed: 2000 MHz"
# * || check_dmi_data_match -h 0x0063 -t 10 "On Board Device Information: Description: Aspeed VGA"
# * || check_dmi_data_match -h 0x0064 -t 41 "Onboard Device: Reference Designation: Aspeed VGA"
# * || check_dmi_data_match -h 0x0068 -t 221 "OEM-specific Type: Strings: IFWI Version"
# * || check_dmi_data_match -h 0x0068 -t 221 "OEM-specific Type: Strings: ME FW Version"
# * || check_dmi_data_match -h 0x0068 -t 221 "OEM-specific Type: Strings: BIOS ACM Version"
# * || check_dmi_data_match -h 0x0068 -t 221 "OEM-specific Type: Strings: BMC FW Version"
# * || check_dmi_data_match -h 0x0068 -t 221 "OEM-specific Type: Strings: FRU SDR Version"
# * || check_dmi_data_match -h 0x0068 -t 221 "OEM-specific Type: Strings: FRU Version"


#######################################################################
###
### Filesystem checks
###
 * || check_fs_mount_rw -t "sysfs" -s "sysfs" -f "/sys"
 * || check_fs_mount_rw -t "proc" -s "proc" -f "/proc"
 * || check_fs_mount_rw -t "devtmpfs" -s "udev" -f "/dev"
 * || check_fs_mount_rw -t "devpts" -s "devpts" -f "/dev/pts"
 * || check_fs_mount_rw -t "tmpfs" -s "tmpfs" -f "/run"
 * || check_fs_mount_rw -t "efivarfs" -s "efivarfs" -f "/sys/firmware/efi/efivars"
 * || check_fs_mount_rw -t "ext4" -s "/dev/md0p2" -f "/"
 * || check_fs_mount_rw -t "securityfs" -s "securityfs" -f "/sys/kernel/security"
 * || check_fs_mount_rw -t "tmpfs" -s "tmpfs" -f "/dev/shm"
 * || check_fs_mount_rw -t "tmpfs" -s "tmpfs" -f "/run/lock"
 * || check_fs_mount_rw -t "pstore" -s "pstore" -f "/sys/fs/pstore"
 * || check_fs_mount_rw -t "bpf" -s "bpf" -f "/sys/fs/bpf"
 * || check_fs_mount_rw -t "hugetlbfs" -s "hugetlbfs" -f "/dev/hugepages"
 * || check_fs_mount_rw -t "mqueue" -s "mqueue" -f "/dev/mqueue"
 * || check_fs_mount_rw -t "debugfs" -s "debugfs" -f "/sys/kernel/debug"
 * || check_fs_mount_rw -t "tracefs" -s "tracefs" -f "/sys/kernel/tracing"
 * || check_fs_mount_rw -t "fusectl" -s "fusectl" -f "/sys/fs/fuse/connections"
 * || check_fs_mount_rw -t "configfs" -s "configfs" -f "/sys/kernel/config"
 * || check_fs_mount_ro -t "ramfs" -s "ramfs" -f "/run/credentials/systemd-sysusers.service"
 * || check_fs_mount_rw -t "vfat" -s "/dev/nvme0n1p1" -f "/boot/efi"
 * || check_fs_mount_rw -t "ext4" -s "/dev/md0p4" -f "/home"
 * || check_fs_mount_rw -t "ext4" -s "/dev/md0p3" -f "/var"
 * || check_fs_mount_ro -t "squashfs" -s "/dev/loop0" -f "/snap/core20/2182"
 * || check_fs_mount_ro -t "squashfs" -s "/dev/loop1" -f "/snap/core20/2318"
 * || check_fs_mount_ro -t "squashfs" -s "/dev/loop2" -f "/snap/lxd/28373"
 * || check_fs_mount_ro -t "squashfs" -s "/dev/loop4" -f "/snap/snapd/21184"
 * || check_fs_mount_ro -t "squashfs" -s "/dev/loop3" -f "/snap/lxd/29351"
 * || check_fs_mount_ro -t "squashfs" -s "/dev/loop5" -f "/snap/snapd/21759"
 * || check_fs_mount_rw -t "ext4" -s "/dev/md0p5" -f "/var/tmp"
 * || check_fs_mount_rw -t "ext4" -s "/dev/md0p1" -f "/tmp"
 * || check_fs_mount_rw -t "ext4" -s "/dev/md0p6" -f "/var/log"
 * || check_fs_mount_rw -t "tracefs" -s "tracefs" -f "/sys/kernel/debug/tracing"
 * || check_fs_mount_rw -t "tmpfs" -s "tmpfs" -f "/run/snapd/ns"
 * || check_fs_mount_rw -t "nsfs" -s "nsfs" -f "/run/snapd/ns/lxd.mnt"
 * || check_fs_mount_rw -t "tmpfs" -s "tmpfs" -f "/run/user/1000"
 * || check_fs_used /dev 90%
 * || check_fs_used /sys/firmware/efi/efivars 90%
 * || check_fs_used / 90%
 * || check_fs_used /boot/efi 90%
 * || check_fs_used /home 90%
 * || check_fs_used /var 90%
 #* || check_fs_used /snap/core20/2182 100%
 #* || check_fs_used /snap/core20/2318 100%
 #* || check_fs_used /snap/lxd/28373 100%
 #* || check_fs_used /snap/snapd/21184 100%
 #* || check_fs_used /snap/lxd/29351 100%
 #* || check_fs_used /snap/snapd/21759 100%
 * || check_fs_used /var/tmp 90%
 * || check_fs_used /tmp 90%
 * || check_fs_used /var/log 90%
 * || check_fs_iused /dev 98%
 * || check_fs_iused / 100%
 * || check_fs_iused /home 100%
 * || check_fs_iused /var 100%
 #* || check_fs_iused /snap/core20/2182 12k
 #* || check_fs_iused /snap/core20/2318 12k
 * || check_fs_iused /var/tmp 100%
 * || check_fs_iused /tmp 100%
 * || check_fs_iused /var/log 100%


#######################################################################
###
### Hardware checks
###
 * || check_hw_cpuinfo 2 112 224
 * || check_hw_physmem 2113410308kB 2113410308kB 3%
 * || check_hw_swap 8GB 8GB 3%
 * || check_hw_ib 100 mlx5_bond_0:1
 * || check_hw_eth lo
 * || check_hw_eth enp86s0f0
 * || check_hw_eth enp83s0f0np0
 * || check_hw_eth enp86s0f1
 * || check_hw_eth enp83s0f1np1
 * || check_hw_eth bond0
 * || check_hw_eth ovs-system
 * || check_hw_eth bond0.20
 * || check_hw_eth ovs-sriov
 * || check_nv_healthmon 
 * || check_nvsmi_healthmon 


#######################################################################
###
### Process checks
###
 * || check_ps_loadavg 448
 * || check_ps_service -r rpcbind
 * || check_ps_service -S -u root -m 'sshd:' sshd
 * || check_ps_service -r -d rpc.statd nfslock


#######################################################################
####
#### Additional memory checks
####
 * || check_cpu_drop_mem_cache 1000000


#######################################################################
#####
##### GPU checks
#####
 * || check_nvsmi_healthmon
 * || check_gpu_persistence
 * || check_nv_healthmon
 * || check_app_gpu_clocks
 * || check_cuda_bw 24.0 10
 * || check_gpu_ecc 20000000 10000
 * || check_gpu_clock_throttling
 * || check_gpu_xid
 * || check_nccl_allreduce 56.0 10
 * || check_gpu_topo
